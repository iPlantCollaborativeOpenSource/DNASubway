<%args>
	$page => 1
	$sort => 'created desc'
</%args>
<%once>
	use DNALC::Pipeline::Project ();
	use DNALC::Pipeline::User ();
	use DNALC::Pipeline::Config ();
	use DNALC::Pipeline::Utils qw(random_string);
	use Data::Dumper;

	my $epp = 10;
</%once>

<%init>
#my $pcf = DNALC::Pipeline::Config->new->cf('PIPELINE');
$r->content_type('text/html');

$m->session->{pipeline} ||= {};
my $s = $m->session->{pipeline};

my $orderby = [$sort];

my $pager = DNALC::Pipeline::Project->pager;
$pager->per_page( $epp );
$pager->page( $page );
$pager->order_by( $sort );

my @projects = $pager->search_where;
my $pages = int($pager->total_entries/$epp) + ($pager->total_entries % $epp > 0 ? 1 : 0);
print STDERR Dumper( $pager ), $/;

</%init>
<table>
<tr>
	<th>Project's name</th>
	<th>Organism</th>
	<th>User</th>
	<th>Created on</th>
</tr>
% for (@projects) {
<tr>
	<td><a href="/project/dashboard.html?pid=<% $_->id %>"><%$_->name%></a></td>
	<td><%$_->organism%>, <% $_->common_name %></td>
	<td><%$_->user_id%></td>
	<td><% $_->created %></td>
</tr>
% }
</table>
<& '/_pager', cur=>$page, pages => $pages, 
	suffix => '', prefix => '/project/browse/?page=' &>
