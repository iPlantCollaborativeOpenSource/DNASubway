<div class="container_data1">
	<div id="container_data_line">&nbsp;</div>
<& /_messages &>

	<div><a href="./app_<% $tool |html %>?pid=<% $pid |html%>" style="text-decoration:none"><input type="button" value="Launch New Job" /></a></div>

	<table id="jobs_table">
		<thead>
			<tr>
				<th>#</th>
				<th>Job Name</th>
				<th>Start Time</th>
				<th>End Time</th>
				<th>Status</th>
				<th>View Results</th>
			</tr>
		</thead>
		<tbody>
% my $i = 1;
% while (my $job = $jobs->next) {
%	my $attrs = $job->attrs;
			<tr>
				<td><% $i++ %></td>
				<td>
					<a href="./job_status?pid=<%$pid |html%>;jid=<% $job %>" style="color:black"><% $attrs->{name} |html%></a>
				</td>
				<td><& .nice_time, ts => $attrs->{submitTime} &></td>
				<td><& .nice_time, ts => $job->status eq "done" ? $attrs->{endTime} : "" &></td>
				<td><% $job->status eq "processing" ? "processing <img src='/images/ajax-loader-2.gif' width='16px;'>" : $job->status %></td>
%# -------- DIFFERENT VISUALIZATION OPTIONS BASED ON TOOL TYPE HERE --------- #%
				<td>
% if ($tool eq "tophat" && $job->status eq 'done') {
					<a href="./launch_igv?pid=<% $proj %>;jid=<% $job %>">view in IGV</a>
% } elsif ($tool eq "cufflinks" && $job->status eq 'done') {
					<a href="./launch_igv_cufflinks?pid=<% $proj %>;jid=<% $job %>">view in IGV</a>
% } elsif ($tool eq "fxtrimmer" && $job->status eq 'done') {
		<& .fxtrimmer, job =>$job, pid => $pid, pm => $pm &>
% }
				</td>
%# ------ END DIFFERENT VISUALIZATION OPTIONS BASED ON TOOL TYPE HERE ------- #%
			</tr>
% }

		</tbody>
	</table>
% if ($launched) {
<script typed="text/javascript">
	top.ngs.set_status('ngs_<% $tool |html %>', 'processing');
</script>
% }
</div> <!-- end container_data1 --> 

%#-----------------------------------------------------------------
<%args>
	$pid => 0
	$tool => ''
	$launched => ''
</%args>
<%once>
	use Data::Dumper;
	use Time::Piece qw/localtime/;
	use DNALC::Pipeline::Utils qw(clean_query);
	use DNALC::Pipeline::App::NGS::ProjectManager ();

	use DNALC::Pipeline::User ();

</%once>
<%init>
	$m->session->{pipeline} ||= {};
	my $s = $m->session->{pipeline};
	
	my $pm = DNALC::Pipeline::App::NGS::ProjectManager->new({project => $pid, debug => 0});
	my $proj = $pm->project;
	
	my $jobs = $pm->get_jobs_by_task('ngs_' . $tool); # show non-deleted jobs only
</%init>

<%def .nice_time>
<%args>
	$ts => 0
</%args>
	<small><% $t->strftime("%D %T")%></small>
<%init>
	return unless $ts;
	$ts /= 1000 if length($ts) > 10;
	my $t = localtime($ts);
</%init>
</%def>
%#---------------------------------------------------------
<%def .fxtrimmer>
<%args>
	$job => undef
	$pm => undef
</%args>
<%init>
	my $f = 0;
	return "" unless $job && $pm;
	my $qc_report = 0;
	my ($trimmed_file) = map {$_->file && $_->file->trimmed_file ? $_->file->trimmed_file :  undef} $job->input_files;
	if ($trimmed_file) {
		$qc_report = $trimmed_file->qc_file_id ? $m->comp("../../.comp/filepath_to_web", file => $trimmed_file->qc_report, just_return => 1) : 0;
	}
</%init>
% if ($qc_report) {
	<a href="<% $qc_report |uri%>">View</a>
% }
</%def>
%#---------------------------------------------------------
%#---------------------------------------------------------