
<& /_messages &>

%#j = <% $jobs %>
<p><strong><a href="./app_th?pid=<% $pid |html%>">Launch new Tophat job</a></strong></p>
% while (my $job = $jobs->next) {
%	my $attrs = $job->attrs;
	<div>
		<a href="./job_status?pid=<%$pid |html%>;jid=<% $job %>"><strong><% $attrs->{name} |html%></strong></a>
% if ($job->status eq 'done') {
		<a href="./launch_igv?pid=<% $proj %>;jid=<% $job %>">view in IGV-static</a>
		&nbsp;<a href="./launch_igv?pid=<% $proj %>;jid=<% $job %>">view in IGV-dynamic</a>
%	}
	</div>
% }
%#-----------------------------------------------------------------
<%args>
	$pid => 0
</%args>
<%once>
	use Data::Dumper;
	use DNALC::Pipeline::Utils qw(clean_query);
	use DNALC::Pipeline::App::NGS::ProjectManager ();

	use DNALC::Pipeline::User ();

</%once>
<%init>

	$m->session->{pipeline} ||= {};
	my $s = $m->session->{pipeline};
	
	#my $apif = iPlant::FoundationalAPI->new(
	#		user => $s->{username},
	#		token => $s->{api_token},
	#		debug => 0,
	#	);
	my $pm = DNALC::Pipeline::App::NGS::ProjectManager->new({project => $pid, debug => 0});
	#$pm->api_instance($apif) if $apif;
	my $proj = $pm->project;
	
	my $jobs = $pm->get_jobs_by_task('ngs_tophat'); # show non-deleted jobs only

</%init>