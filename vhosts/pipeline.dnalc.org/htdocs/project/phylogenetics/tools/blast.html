
<div id="phy-blast">
	<input type="hidden" id="step" value="8" />
	<div id="container_data_line"></div>
	<div id="seqids">
		<pre>
% for (@pairs) {
%	my $name = lcs_name( map {$_->seq->display_id} $_->paired_sequences);
<span id="x<% $_ |html %>"><% $name |html%></span>
% }
% for (@sequences) {
<span id="x<% $_ |html %>"><% $_->display_id |html%></span>
% }
</pre>
	</div>
	<div id="seqs">
	
		<pre>
% for (@pairs) {
%	my $consensus = $_->consensus;
%	if ($consensus) {
<span id="x<% $_ |html %>"><% $consensus |html%></span>
%	} else {
	<span>Consensus not built for this pair!</span>
%	}
% }
% for (@sequences) {
<span id="<%$_%>" ><% $_->seq|html %></span>
% }
</pre>
	</div>

	<div id="seqops" class="seqops">
		<pre>
% for (@pairs) {
%	if ($_->consensus) {
%		my ($blast_run) = BlastRun->search(run_id=>$pid . '-p' . $_->id);
%if ($blast_run){
<span id ='p<%$_->id%>'><a href='/project/phylogenetics/tools/view_blast?bid=<%$blast_run->bid%>;pid=<%$pid%>;sid=p<%$_->id%>'>View</a></span>
%}
%else{
<span id ='p<%$_->id%>'><span id='blp<%$_->id%>'><a href='#' onclick="phy.do_blast('p<%$_->id%>');">blast</a></span></span>
%}
%	}
%	else {

%	}
% }
% for (@sequences) {
%	my ($blast_run) = BlastRun->search(run_id=>$pid . '-s' . $_->id);
%if ($blast_run){
<span id ='s<%$_->id%>'><a href='/project/phylogenetics/tools/view_blast?bid=<%$blast_run->bid%>;pid=<%$pid%>;sid=s<%$_->id%>'>View</a></span>
%}
%else{
<span id ='s<%$_->id%>'><span id='blp<%$_->id%>'><a href='#' onclick="phy.do_blast('s<%$_->id%>');">blast</a></span></span>
%}
%#<span id="bls<% $_->id %>"><a href="#" onclick="phy.do_blast('s<%$_->id%>');">blast</a></span> <span id ="s<%$_->id%>"><% $blast_run ? "<a href='/project/phylogenetics/tools/view_blast?bid=" . $blast_run->bid . ";pid=" . $pid . ";sid=s" . $_->id . "'>View</a>" : "" %></span>
% }
</pre>
<input type="hidden" id="pid" value="<% $proj->id %>" />

</div>

<div style="clear: both;">&nbsp;</div>
     <div id="container_data_lineBottom">&nbsp;</div>
     

</div> <!-- END of container_data2-->



<%args>
	$op => ''
	$data => ''
	$pid => 0
	$fid => 0
</%args>
<%once>
	use File::Slurp qw/read_file/;
	use DNALC::Pipeline::App::Phylogenetics::ProjectManager ();
	use DNALC::Pipeline::Phylogenetics::DataSequence ();
	use aliased 'DNALC::Pipeline::Phylogenetics::BlastRun';
	use DNALC::Pipeline::Config ();
	use DNALC::Pipeline::Utils qw/lcs_name/;
	use Data::Dumper;
</%once>
<%init>
	$r->content_type("text/html");
	
	my @sequences = ();

	my $pm = DNALC::Pipeline::App::Phylogenetics::ProjectManager->new($pid);
	my $proj = $pm->project;
	unless ($proj) {
		#$m->comp('/_message_add', 'Project not found!', 'error');
		#$m->redirect('/project/');
		print "Project not found!";
		return;
	}
	
	my @pairs = $pm->pairs;
	
	# get non paired sequences
	@sequences = $pm->initial_sequences;

</%init>
<%attr>
	js => ['prototype-1.6.1.js', 'phylogenetics.js']
</%attr>
