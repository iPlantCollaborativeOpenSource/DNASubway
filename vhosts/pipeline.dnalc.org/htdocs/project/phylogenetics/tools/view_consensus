<div id="view-consensus">
% unless ($proj) {
	Error: can't open project "<% $pid|html%>".
% } 
% else {
	<div style="width: 15%;float:left;overflow: none;">
	<ul>
%	my $cnt = 1;
%	for my $p (@pairs) {
		<li>
			<div><a href="./view_consensus?pid=<%$pid |html%>;pair_id=<% $p->id %>">Pair <% $cnt++%></a></div>
			<small>Â·<% join "+", map{$_->seq->display_id} $p->paired_sequences |html%></small>
		</li>
%	}
	</ul>
	</div>
	<div style="width: 85%;float:left;background:silver;">
%	if ($pair) {
		<div>Pair <% join "+", map{$_->seq->display_id} $pair->paired_sequences |html%></div>
		<div style="overflow: auto;" class="monospace">
			<div id="labels">
				<div id="seq1_name"></div>
				<div id="seq2_name"></div>
				<div id="consensus_div_name"></div>
			</div>
			<div id="colons" style="display:none">
				<div>:</div>
				<div>:</div>
				<div>:</div>
			</div>
			<div id="sequences">
				<div id="seq1_div"></div>
				<div id="seq2_div"></div>
				<div id="consensus_div_seq"></div>
			</div>
		</div>
		
		<p><img id="progress" style="padding-left:100px;display:none" src="/images/ajax-loader-2.gif" alt=""></p> 
		<div id="change_base_area" class="monospace" style="padding-top:15px;padding-left:5px;"></div>
		<div id="trace_canvas_div" style="display:none">
			<canvas id="trace_viewer_1" height="210">Your browser doesnt support canvas objects.</canvas>
			<canvas id="trace_viewer_2" height="210">Your browser doesnt support canvas objects.</canvas>
		</div>
		<div id="save_changes_button_div">
			<input type="button" id="save_changes_btn" value="Save Changes" onclick="phy.consensus_change()" style="margin-left:5px;display:none"/>
		</div>
%	}
	</div>
% }
</div>


<input type="hidden" id="step" value="5" />		
<input type="hidden" id="seq1" value="<% $seq1 %>" />
<input type="hidden" id="seq2" value="<% $seq2 %>" />
<input type="hidden" id="display_name_1" value="<% $display_name_1 %>" />
<input type="hidden" id="display_name_2" value="<% $display_name_2 %>" />
<input type="hidden" id="consensus" value="<% $consensus %>" />
<input type="hidden" id="pair_id" value="<% $pair_id %>" />

%#----------------------------------------------------------------------------
<%args>
	$pid => 0
	$pair_id => 0
</%args>
%#----------------------------------------------------------------------------
<%once>
	use DNALC::Pipeline::App::Phylogenetics::ProjectManager ();
	use DNALC::Pipeline::Phylogenetics::Pair ();
	use File::Slurp qw(read_file);
</%once>
%#----------------------------------------------------------------------------
<%init>
	$r->content_type("text/html");
	my ($status, $msg) = ("error", "");
	$pid =~ s/\D+//g;
	my $pm = DNALC::Pipeline::App::Phylogenetics::ProjectManager->new($pid);
	my $proj = $pm->project;
	my @pairs = ();
	my @seqs = ();
	my ($pair) = undef;
	my $seq1;
	my $seq2;
	my $display_name_1;
	my $display_name_2;
	my $consensus; 
	my $alignment;
	my @alignment_line_1;
	my @alignment_line_2;
	
	
	
	unless ($proj) {
		$msg = "Project not found."
	}
	else {
		@pairs = $pm->pairs;
		($pair) = grep {$_->id == $pair_id} @pairs;
		@seqs = $pair->paired_sequences if $pair;
		$alignment = $pair->alignment if $pair;
		@alignment_line_1 =(split(': ',(split('\n', $alignment))[0]));
		@alignment_line_2 =(split(': ',(split('\n', $alignment))[1]));
		($display_name_1, $seq1) = ($alignment_line_1[0], $alignment_line_1[1]);
		($display_name_2, $seq2) = ($alignment_line_2[0], $alignment_line_2[1]);
		$consensus = $pair->consensus if $pair;
		

	}
</%init>
<%attr>
	js => ['prototype-1.6.1.js', 'phylogenetics.js']
	load_ie_canvas => 1
</%attr>
%#----------------------------------------------------------------------------
