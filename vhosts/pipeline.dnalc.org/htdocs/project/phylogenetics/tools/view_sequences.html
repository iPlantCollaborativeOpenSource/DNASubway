
<div class="container_data1">
	<div id="container_data_line">&nbsp;</div>
	<div id="seqids" class="seqids">
		<pre>
% for (@files) {
<span id="x<% $_ |html %>"><a href="./view_sequences.html?pid=<% $pid |html%>;fid=<% $_->id %>"><% $_->file_name |html%></a></span>
% }
% for (@sequences) {
<span id="x<% $_->display_id |html %>"><% $_->display_id |html%></span>
% }
</pre>
	</div>
	<div id="seqs" class="seqs">
% if ($file) {
	<input type="hidden" id="step" value="2" />
	<input type="hidden" id="seq_data" value="<% $file->seq |html%>" />
	<input type="hidden" id="seq_a" value="<% join ",", @{$traces->{A}} %>" />
	<input type="hidden" id="seq_t" value="<% join ",", @{$traces->{T}} %>" />
	<input type="hidden" id="seq_c" value="<% join ",", @{$traces->{C}} %>" />
	<input type="hidden" id="seq_g" value="<% join ",", @{$traces->{G}} %>" />
	<input type="hidden" id="qvalues" value="<% join ",", $file->quality_values %>" />
	<input type="hidden" id="b_locations" value="<% join ",", $file->base_locations %>" />
	<div>
		<canvas id="canvas1" height="200">
			Your browser isn't supporting canvas objects.
		</canvas>  
	</div>
%#	<pre><% Dumper($file)%></pre>
% } else {
		<pre>
% for (@files) {
<span id="<%$_%>" ><% $_->seq|html %></span>
% }
% for (@sequences) {
<span id="<%$_%>" ><% $_->seq|html %></span>
% }
</pre>
% }
	 </div>
%#     <div style="clear: both;">&nbsp;</div>
% if ($file) {
	 <div class="seqs">
		<div style="float:left; width: 100px;"><input type="button" id="zoom_reset" value=" Reset " onclick="phy.zoomReset()"/></div>
		<div style="float:left; width: 200px; text-align: center;">
			X:<input type="button" id="x_zoom_in" value="  +  " onclick="phy.zoomIn('x')"/><input type="button" id="x_zoom_out" value="  -  " onclick="phy.zoomOut('x')"/>
		</div>
		<div style="float:left; width: 200px; text-align: right;">
			Y:<input type="button" id="y_zoom_in" value="  +  " onclick="phy.zoomIn('y')"/><input type="button" id="y_zoom_out" value="  -  " onclick="phy.zoomOut('y')"/>
		</div>
	</div>
% }
     <div id="container_data_lineBottom">&nbsp;</div>
</div> <!-- END of container_rightContent-->

<%args>
	$op => ''
	$data => ''
	$pid => 0
	$fid => 0
</%args>
<%once>
	use File::Slurp qw/read_file/;
	use DNALC::Pipeline::App::Phylogenetics::ProjectManager ();
	use DNALC::Pipeline::Phylogenetics::DataSequence ();
	use DNALC::Pipeline::Config ();
	#use JSON::XS ();
	use Data::Dumper;
</%once>
<%init>
	$r->content_type("text/html");
	my $pairs = undef;
	
	my @sequences = ();
	my ($file, $traces);

	my $pm = DNALC::Pipeline::App::Phylogenetics::ProjectManager->new($pid);
	my $proj = $pm->project;
	unless ($proj) {
		#$m->comp('/_message_add', 'Project not found!', 'error');
		#$m->redirect('/project/');
		print "Project not found!";
		return;
	}
	
	my @files = $pm->files("trace");
	if (@files) {
		#@sequences = DNALC::Pipeline::Phylogenetics::DataSequence->search_trace_sequences($pid);
		#print STDERR "trace seq\n";
		if ($fid && $fid =~ /^\d+$/) {
			($file) = grep {$_->id == $fid } @files;
			unless (-f $file->file_path) {
				$file = undef;
			}
			$traces = $file->trace if $file;
		}
	}
	else {
		@sequences = $pm->sequences;
	}
</%init>
<%attr>
	js => ['prototype-1.6.1.js', 'phylogenetics.js']
	load_ie_canvas => 1
</%attr>

