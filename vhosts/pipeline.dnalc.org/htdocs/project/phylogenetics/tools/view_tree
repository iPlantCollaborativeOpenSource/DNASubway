<div id="conbodyx">
% unless ($proj) {
	Error: can't open project "<% $pid|html%>".
% } else {
	<div>
<applet archive="/files/jalview/jalviewApplet.jar" name="Jalview" 
	codebase="/" 
	code="jalview.bin.JalviewLite" height="450" width="100%">
	<param name="cache_option" value="No" />
	<param name="file" value="<% $m->comp('../../.comp/filepath_to_web', file => $pm->get_alignment ) %>" />
	<param name="treeFile" value="<% $m->comp('../../.comp/filepath_to_web', file => $tinfo->{tree_file} ) %>" />
	<param name="embedded" value="true" />
	<param name="showAnnotation" value="true" />
	<param name="wrap" value="false" />
	<param name="nojmol" value="true" />
	<param name="windowHeight" value="500" />
	<param name="windowWidth" value="750" />
	<param name="showFullId" value="false" />
	<param name="defaultColour" value="<%  defined $color{lc $proj->type} ? $color{lc $proj->type} : $color{default} %>" />
%#	<param name="linkLabel_1" value="Details" />
%#	<param name="linkUrl_1" value="<% $pcf->{PROJECT_HOME} %>/project/target/details?hn=$SEQUENCE_ID$" />
	<param name="showbutton" value="false" />
	<param name="debug" value="true" />
</applet>

	<pre>
	1: <% $m->comp('../../.comp/filepath_to_web', file => $pm->get_alignment )%>
	2: <% $m->comp('../../.comp/filepath_to_web', file => $tinfo->{tree_file} ) %>
	3: tt= <% $tinfo->{tree}->tree_type %>
	</pre>
	</div>
% }
</div>
%#----------------------------------------------------------------------------
<%args>
	$pid => 0
	$t => ''
	$tid => ''
</%args>
%#----------------------------------------------------------------------------
<%once>
	use DNALC::Pipeline::App::Phylogenetics::ProjectManager ();
	my %color = (
			default => 'Clustal',
			mtdna => '% Identity',
			protein => 'Zappo',
		);
</%once>
%#----------------------------------------------------------------------------
<%init>
	$r->content_type("text/html");
	my $pcf = DNALC::Pipeline::Config->new->cf('PIPELINE');
	$pid =~ s/\D+//g;

	my $tree_type = ($t =~ /^phy_tree_ml$/) ? 'ML' : 'NJ';

	my $pm = DNALC::Pipeline::App::Phylogenetics::ProjectManager->new($pid);
	my $proj = $pm->project;
	my $tinfo = $proj ? $pm->get_tree($tree_type) : {};
</%init>
%#----------------------------------------------------------------------------
