<%args>
	$pid => 0
	$public => undef
	$type => ''
</%args>
%#--------------------------------------------------------
<%once>
	use DNALC::Pipeline::MasterProject ();
	use DNALC::Pipeline::App::ProjectManager ();
	use DNALC::Pipeline::TargetProject ();
	use DNALC::Pipeline::Config ();
	use DNALC::Pipeline::Utils qw(random_string);
	#use DNALC::Pipeline::App::Utils ();

	use Data::Dumper;

</%once>
%#--------------------------------------------------------
<%init>
#my $pcf = DNALC::Pipeline::Config->new->cf('PIPELINE');
$r->content_type('text/plain');

my $s = $m->session->{pipeline};

my $status  = 'error';
my $message = '';

unless ($s->{logged_in}) {
	$message = 'Your session expired. Please login!';
} else {

	my ($mp) = DNALC::Pipeline::MasterProject->search(user_id => $s->{user_id}, project_id => $pid, project_type => $type);
	unless ($mp) {
		$message = "Project not found!";
	}
	else {
		if (defined $public && $mp->public != $public) {
			$mp->public($public);
		}
		
		if ($mp->is_changed && $mp->update) {
			$status = 'success';
		}
	}	
}
</%init>
<%flags>
	inherit => undef
</%flags>
{'status':'<% $status %>', 'message':'<% $message %>'}
