<%args>
	$t => ''
	$pid => 0
</%args>
%#-------------------------------------------------
<%once>
	use DNALC::Pipeline::Project ();
	use DNALC::Pipeline::Config ();
	use DNALC::Pipeline::App::WorkflowManager ();
	use DNALC::Pipeline::Utils qw(isin);
	use Data::Dumper;

	use Gearman::Client ();

	my @routines = qw/trna_scan augustus fgenesh repeat_masker/;
</%once>
%#-------------------------------------------------
<%init>
	$r->content_type('text/plain');

	$m->session->{pipeline} ||= {};
	my $s = $m->session->{pipeline};

	unless ($t) {
		print "{'status':'error', 'message': 'Task unknown.'}";
		return;
	}

	my $proj = DNALC::Pipeline::Project->retrieve($pid);
	unless ($proj) {
		print "{'status':'error', 'message':'Project unknown.'}";
		return;
	}
	my $client = Gearman::Client->new;
	$client->job_servers('127.0.0.1');
	my $h = $client->dispatch_background( $t => $pid);
	#print STDERR  "Launched [$t], h = ", $h, $/;
</%init>
<%flags>
	inherit => undef
</%flags>
% if ($h) {
{'status':'success', 'h':'<% $h %>'}
% } else {
{'status':'error', 'message':'Unable to submit job request.'}
% }
%# vim: ft=mason
