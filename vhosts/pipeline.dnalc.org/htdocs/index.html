    	<div id="home_map">
		  <div id="map_left">
			<span id="map_spacer">
% if ($s->{logged_in} && $s->{new_user}) {
			<div id="startHere"></div>
% }
			</span>
     		<span class="bt_redStart_home" id="tt_red1"><a href="<% $s->{logged_in} ? "/project/create_project.html" : "#" %>"
				style="cursor: <% $s->{logged_in} ? "pointer" : "default"%>;"<% $s->{logged_in} ? "" : " class=\"nohover\"" %>></a></span>
<script type="text/javascript" language="javascript">
new Tip('tt_red1', "Input a DNA sequence of up to 100,000 nucleotides to identify the genes and transposons in it, and annotate (associate) the sequence with this information.", {
		title: "Annotate a Genomic Sequence",
		border: 5,
		radius: 5,
		style: 'red'
	});
</script>

		<span class="bt_yellowStart_home" id="tt_yellow1"><a href="<% $s->{logged_in} ? "/project/target/create" : "#" %>" 
			style="cursor: <% $s->{logged_in} ? "pointer" : "default"%>;"<% $s->{logged_in} ? "" : " class=\"nohover\"" %>></a></span>
<script type="text/javascript" language="javascript">
new Tip('tt_yellow1', "Input a gene or protein of up to 10,000 nucleotides/amino acids to identify related sequences within sequenced genomes.", {
		title: "Prospect Genomes",
		style: 'yellow'
	});
</script>
<!--
		<span class="bt_blueStart_home" id="tt_blue1"><a href="#" style="cursor: default;"></a></span>
<script type="text/javascript" language="javascript">
new Tip('tt_blue1', "<span class='comingsoon'>Coming Soon...</span> Input a set of Expressed Sequence Tags (ESTs) of up to 100 megabytes of assembled data to determine the potential natures of the genes captured.", {
		title: "Analyze Transcript Data",
		style: 'blue'
	});
</script>
-->
	</div><!--END of ID map_left-->
           
	<div id="map_right">
	<div class="containerHoz1">
		<span class="spacer1"></span>
		<span class="conConsole_info" id="tt_red2"></span>
<script type="text/javascript" language="javascript">
new Tip('tt_red2', "Identify and mask repeats and transposons that can obstruct sequence analysis.", {
		title: "Find Repeats",
		style: 'red'
	});
</script>

		<span class="spacer3"></span>
		<span class="conConsole_info" id="tt_red3"></span>
<script type="text/javascript" language="javascript">
new Tip('tt_red3', "Identify DNA patterns typical for genes using gene prediction algorithms Augustus, FGenesH, SNAP, and tRNA Scan.", {
		title: "Predict Genes",
		style: 'red'
	});
</script>

		<span class="spacer3"></span>
		<span class="conConsole_info" id="tt_red4"></span>
<script type="text/javascript" language="javascript">
new Tip('tt_red4', "Search the sequence for matches to known genes and proteins using search algorithms BLASTN and BLASTP.", {
		title: "Search Databases",
		style: 'red'
	});
</script>

		<span class="spacer3"></span>
		<span class="conConsole_info" id="tt_red5"></span>
<script type="text/javascript" language="javascript">
new Tip('tt_red5', "Synthesize gene predictions and search results into gene models using the annotation editor Apollo.", {
		title: "Build Models",
		style: 'red'
	});
</script>
	</div><!--END of CLASS containerHoz-->

	<div class="containerHoz2">
		<span class="spacer1"></span>
		<span class="spacer2"></span>
		<span class="conConsole_info" id="tt_yellow2"></span>
<script type="text/javascript" language="javascript">
new Tip('tt_yellow2', 'Search genomes for matches to a gene using search algorithms BLASTN or TBLASTN.', {
		title: "Search Genomes",
		style: 'yellow'
	});
</script>

		<span class="spacer1"></span>
		<span class="spacer3"></span>
		<span class="conConsole_info" id="tt_yellow3"></span>
<script type="text/javascript" language="javascript">
new Tip('tt_yellow3', "View BLAST search results in multiple alignment format and as tree view.", {
		title: "Alignment &amp; Tree Viewer",
		style: 'yellow'
	});
</script>

		<span class="spacer1"></span>
%#		<span class="spacer2"></span>
		<span class="conConsole_info" id="tt_black1" style="width:260px;height: 70px;"></span>
<script type="text/javascript" language="javascript">
new Tip('tt_black1', "View analysis results and annotations in a genome browser. Transfer a gene to the Prospecting track (Yellow Line) to identify similar sequences within entire genomes.", {
		title: "Browsers &amp; Transfer",
		style: 'black'
	});
</script>
 	</div><!--END of CLASS containerHoz-->

	</div><!--END of ID map_right-->
	</div><!--END of ID home_map-->
<div id="con_tour">
	<div class="bt_tour"><a href="#" onclick="javascript:launch_tour()" title="Launch tour"></a></div>
	<div class="bt_poster"><a href="/files/pdf/DNA_Subway_Poster.pdf" title="DNA Subway poster"></a></div>
    <div class="bt_Guide"><a href="/files/pdf/DNA_Subway_Guide.pdf" title="DNA Subway guide"></a></div>
</div>
    <div id="home_intro" class="container_text">This site ties together key bioinformatics tools and databases used to annotate genes and 
analyze genome data. Roll over any of the "stations" on the subway map to find out more about the analysis steps. 
Start a project by selecting one of the "subway lines" (red, yellow). Register and login to be able to save or share your results.</div>

% if ($s->{warn_guest}) {
<div id="message_list" style="display:none;">
	<p>Guest accounts are temporary.</p>
	<p>&nbsp;</p>
	<p>Guest users cannot use the Red Line's FGenesH gene predictor on uploaded sequences.</p>
</div>
% 	delete $s->{warn_guest};
%}

%#-------------------------------------------------------------------
<%args>
	$name => ''
	$passw => ''
	$guest => ''
	$login => ''
</%args>
%#-------------------------------------------------------------------
<%once>
	use DNALC::Pipeline::Utils qw/random_string/;
	use DNALC::Pipeline::User ();
	use DNALC::Pipeline::UserProfile ();
	use DNALC::Pipeline::Config ();
	use Time::Duration qw/duration/;
</%once>
%#-------------------------------------------------------------------
<%init>
$m->session->{pipeline} ||= { username => "", logged_in => 0};
my $s = $m->session->{pipeline};

#print STDERR "name = $name//sess =$s->{username} \n";

my @err = ();

if ($r->method eq "POST") {

	my $user;

	if ($guest) {
		if ($name && $name =~ /^guest_/) {
			($user) = DNALC::Pipeline::User->search(username => $name, active => "true");
			$name = undef unless $user;
		}

		# if (!$name || $name !~ /guest/)
		unless ($name && $name =~ /^guest_/) {
			my $rand = lc random_string(6, 8);

			$name = "guest_$rand";
			my $chado_db = $name;
			
			my $pcf = DNALC::Pipeline::Config->new->cf("PIPELINE");
			my $guest_chado_instanced = $pcf->{CHADO_GUEST_INSTANCES};
			if ($guest_chado_instanced && $guest_chado_instanced =~ /^\d+$/) {
				$chado_db = "guest_" . int(rand $guest_chado_instanced);
			}

			print STDERR "Generated user: ", $name, "; db = ", $chado_db, $/;
			$user = eval {
					DNALC::Pipeline::User->create({
						username => $name,
						name_first => "Guest",
						name_last => ucfirst $rand,
						email => '',
						password => random_string(8,8),
						#chado_db => $chado_db,
					});
				};
			if ($@) {
				push @err, $@;
			}
			$s->{warn_guest} = 1;
		}
	}
	else {
		($user) = DNALC::Pipeline::User->search(username => $name);
		$s->{username} = $name;
		unless ($user && $user->password_valid($passw)) {
			$user = undef;
		}
		if ($user && !$user->active) {
			$user = undef;
			$m->comp("/_message_add", "Account is blocked. Contact the admin of the site for info.");
			$m->redirect("/");
		}
	}
	if ($user) {
		$s->{username} = $user->username;
		$s->{full_name} = $user->full_name;
		$s->{user_id} = $user->id;
		$s->{institution} = DNALC::Pipeline::UserProfile->get_user_institution($user->id);
		$s->{logged_in} = 1;
		
		$user->increment_login_count;

		if ($user->has_projects) {
			$m->redirect("/project/browsemy");
		}
		else {
			$s->{new_user} = 1;
			$m->redirect("/");
		}
	}
	else {
		if ($name =~ /^guest_/) {
			$s->{username} = '';
		}
		$m->comp("/_message_add", "Unable to log you in. Try again.");
		$m->redirect("/");
	}
}
else {
	#print STDERR "GET username = ", $s->{username}, $/;
}

</%init>
%#-------------------------------------------------------------------

